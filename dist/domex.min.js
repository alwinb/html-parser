var Pe=console.log.bind(console),se=1,re=511,Ce=~re;var I=()=>["",se++<<9],we=()=>se++<<9,ve=(n={},s=0)=>new Proxy({},{get:(o,e)=>n[e]||(n[e]=1<<s++)}),H={},{START:O,END:q,SKIP:J,LEAF:$,ASSOC:K,INFIX:Q,PREFIX:R,POSTFIX:Y,GROUP:P}=ve(H),Ae=n=>(...s)=>[String.raw(...s).replace(/\s+/g,""),n],[De,E,Le,C,U,S,X]=[O,$,R,Q,K,Y,q].map(Ae);function oe(n){let s="",o=[],e=new RegExp(n.map(([c,a,...i])=>(o.push({type:a,info:i}),`(${c})`)).join("|"),"ys");e.infos=o,Object.defineProperty(e,"next",{value:r});function r(c,a){this.lastIndex=a;let i=this.exec(c);if(!i)return null;let u=1;for(;i[u]==null;)u++;let{type:b,info:w}=o[u-1];return[b,i[u],...w]}return e}function ae(n){let s={},o={};for(let e in n){let r=n[e],{types:c,lexer:a}=ke(e,r,n);s[e]=a,o[e]=c}return{lexers:s,types:o}}function ke(n,s,o){let{end:e,skip:r={},sig:c=[]}=s,a=[],i=[],u={};for(let k in r){let l=r[k];a.push([l,J]),i.push([l,J])}i.push([e[0],q]);for(let k=0,l=c.length;k<l;k++)for(let m in c[k]){let f=c[k][m],d=we(),p=0;if(typeof f[0]=="number"){let[h,v,_,F]=f;u[m]=d|h|P,p=[v,d|O|h,k,_]}else{let[h,v]=f;u[m]=d|=v,p=[h,d],d&$||(p[2]=k)}p[1]&(R|$)?a.push(p):i.push(p)}let b=n,w=oe(a),y=oe(i);return{name:b,types:u,lexer:{name:b,Before:w,After:y}}}var x=Symbol("PRE "),le=Symbol("POST");function ie(n,s,o,e=(...r)=>r){let r,c,a,i,u,b,w,y;return this.parse=m,this;function k(f){let d=new ee(s,n[s[3]]);return r=[d],i=0,u=1,b=0,a=f,c=null,w=d.lexer,y=x,d}function l(){let f=y===x?w.Before:w.After,d=f.next(a,i);if(d==null){if(i<a.length&&f.lastIndex<i||y===x)throw new _e(a,i,u,b);return o}else d[1]===`
`&&(u++,b=i+1);return i=f.lastIndex,d}function m(f){for(let d,{ops:p,builds:h}=k(f);;){let v=d||l(),_=d?d[0][0]:v[0],F=_&($|O|J)?-1:p.length-1;for(;F>=0;F--){let A=p[F],M=typeof A[0]=="number"?A:A[0];if(!(_&q||Ee(M,v)))break;p.length--;let V=M[3],W=h.length-V;M.length=2,h[W]=M[0]&P?e(...A.concat(h.splice(W,V))):e(A,...h.splice(W,V))}if(_&q){if(d=r.pop().collapse(v),r.length)({ops:p,builds:h,lexer:w}=r[r.length-1]);else return e(...d);continue}if(_&O){let A=new ee(v,n[v[3]]);({ops:p,builds:h,lexer:w}=r[r.length]=A),y=x}else if(_&$)h[h.length]=d?e(...d):e(v),y=le;else if(p.length&&_&K&&v[0]===p[p.length-1][0])p[p.length-1][3]++,y=x;else if(_&(R|Q|K)){p[p.length]=v;let A=_&P?v[0]:v;A[3]=A[0]&R?1:2,y=x}else if(_&Y){let A=h.length-1;_&P?(v[0].length=2,h[A]=e(...v,h[A])):(v.length=2,h[A]=e(v,h[A])),y=le}d=null}}}var ce=/([^\n]{0,80})/ys;function _e(n,s,o,e){let r=Math.max(e,s-80);ce.lastIndex=e;let c=ce.exec(n)[1];return new SyntaxError(`Invalid expression. At line ${o}:${s-e}:

		${c}
		${"^".padStart(s-e+1)}`)}function Ee(n,s){let o=n[2],e=s[2];return o>e?!0:!!(o===e&&o[0]&re===Y)}var ee=class{constructor(s,o){this.opener=s,this.lexer=o,this.ops=[],this.builds=[]}collapse(s){let[o,e,r]=this.opener,c=o&R?1:o&Q|K?2:0,a=[o&~O|P,e+s[1]];return c&&a.push(r,c),[a,this.builds[0]]}};var{LEAF:ue,POSTFIX:fe}=H,Ke=console.log.bind(console),D=(...n)=>String.raw(...n).replace(/\s+/g,""),de=(...n)=>{if(n.length!==2)throw new Error("wrapfix operator definition must use one placeholder");let[s,o]=n[0].raw.map(e=>e.replace(/\s/g,""));return[ue,s,n[1],o]},pe={space:D`[\t\f\x20]+`,newline:D`[\n]`,comment:D`// [^\n]*`},Se={Dom:{name:"Dom",skip:pe,end:X`[)]`,sig:[{elem:E`[a-zA-Z] [a-zA-Z0-9_\-]*`,deref:E`[@] [a-zA-Z] [a-zA-Z0-9_\-]*`,value:E`[%] [a-zA-Z0-9_\-]*`,key:E`[$]`,group:de`[(]  ${"Dom"}   [)]`,text:de`["]  ${"Chars"} ["]`},{declare:U`[;]`},{orelse:U`[|]`},{descend:C`[>]`,sibling:C`[+]`},{class:S`[.] [a-zA-Z_\-] [a-zA-Z0-9_\-]*`,hash:S`[#] [a-zA-Z_\-] [a-zA-Z0-9_\-]*`,def:S`[@] [a-zA-Z_] [a-zA-Z0-9_]*`,ttest:S` :: [a-zA-Z_] [a-zA-Z0-9_]*`,test:S`[:] [a-zA-Z_] [a-zA-Z0-9_]*`,bindi:S`[~] (?: [0] | [1-9] [0-9]*)`,bind:S`[~] [a-zA-Z_] [a-zA-Z0-9_]*`,iter:S`[*] (?:[a-zA-Z_] [a-zA-Z0-9_]*)?`,addvaluei:S`[%] (?: [0] | [1-9] [0-9]*)`,addvalue:S`[%] (?:[a-zA-Z_] [a-zA-Z0-9_]*)?`,addkey:S`[$]`,addtext:[fe,'["]',"Chars",'["]'],attr:[fe,"[[]","Attr","]"]}]},Attr:{name:"Attr",skip:pe,end:X`\]`,sig:[{unquoted:E`[a-zA-Z] [a-zA-Z0-9_\-]*`,valueIn:E`[%] [a-zA-Z0-9]*`,keyIn:E`[$]`,stringIn:[ue,D`["]`,"Chars",D`["]`]},{collate:U`.{0} (?![[=])`},{assign:C`[=]`}]},Chars:{name:"Chars",end:X`["]`,sig:[{strChars:E`[^\x00-\x19\\"]+`,escape:E`[\\]["/\\bfnrt]`,hexescape:E`[\\]u[a-fA-F0-9]{4}`,empty:E`.{0}(?=")`},{strCat:C`.{0}(?!")`}]}},T=ae(Se),be={void:I(),letin:I(),withlib:I(),context:I(),append:I(),unsafeRaw:I()},t={};for(let n in be)t[n]=be[n][1];for(let n in T.types)for(let s in T.types[n])t[s]=T.types[n][s];var L={};for(let n in t)L[t[n]]=n;function te(n,s){let o=T.lexers.Dom.Before.next("("),e=T.lexers.Dom.After.next(")");return new ie(T.lexers,o,e,s).parse(n)}var Ve=console.log.bind(console);function z({expr:n,ops:s,name:o}){if(s){let e,r;for(e=s;e[r=e.length-1]!=null;e=e[r]);e[r]=n,n=s}return o!=null&&(n=[[t.letin,o],n,[[t.deref,o]]]),n}var Ie={b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function ne(...n){let[[s,o],e,r]=n;switch(s){case t.group:return e;case t.text:return{expr:[[t.text,e]],ops:null,name:null};case t.elem:case t.key:case t.deref:return{expr:n,ops:null,name:null};case t.value:{let u=[[t.value,"%"]],b=o.length>1?[[t.bind,"~"+o.substr(1)],null]:null;return{expr:u,ops:b,name:null}}case t.sibling:case t.orelse:{let u=[n[0]];for(let b=1,w=n.length;b<w;b++)u[b]=z(n[b]);return{expr:u}}case t.declare:let c=Object.create(null),a=n.length-1;for(let u=1;u<a;u++){let b=z(n[u]);if(b[0][0]===t.letin){let w=b[0][1].substr(1);c[w]=b[1]}}let i=n[a];return{expr:[[t.withlib,c],i.expr],name:i.name,ops:i.ops};case t.descend:{let b=[[t.descend,o],e.expr,z(r)];return{expr:z({ops:e.ops,expr:b,name:e.name})}}case t.def:if(e.name!=null)throw new Error(`expression ${o} is already named ${name}`);return{name:o,expr:e.expr,ops:e.ops};case t.iter:return{ops:[n[0],e.ops],name:null,expr:e.expr};case t.bind:case t.bindi:case t.test:case t.ttest:case t.class:case t.hash:return{ops:[n[0],e.ops],name:e.name,expr:e.expr};case t.attr:{switch(e[0][0]){case t.unquoted:case t.collate:case t.assign:break;default:throw new TypeError("Invalid attribute expression")}return{ops:[n[0],e,r.ops],name:r.name,expr:r.expr}}case t.addtext:{let u=[[t.append," "],r.expr,[[t.text,e]]];return{ops:r.ops,name:r.name,expr:u}}case t.addkey:{let u=[[t.append," "],e.expr,[[t.key,"$"]]];return{ops:e.ops,name:e.name,expr:u}}case t.addvalue:case t.addvaluei:{let u=[[t.value,o]];o.length>1&&(u=[[t.bind,"~"+o.substr(1)],u]);let b=[[t.append," "],e.expr,u];return{ops:e.ops,name:e.name,expr:b}}case t.collate:for(let u=1,b=n.length;u<b;u++)switch(n[u][0][0]){case t.assign:case t.unquoted:break;default:throw new TypeError("Invalid attribute expression")}return n;case t.unquoted:case t.valueIn:case t.keyIn:return n;case t.stringIn:return[[n[0][0],e]];case t.assign:{let u=r[0][0];if(e[0][0]!==t.unquoted)throw new TypeError("Lhs of `=` must be an attribute name token");if(u===t.assign)throw new TypeError("Rhs of `=` must not be an assignment");return[n[0],e,r]}case t.strChars:return o;case t.escape:return Ie[o[1]]||o[1];case t.empty:return"";case t.hexescape:return String.fromCodePoint(parseInt(o.substr(2),16));case t.strCat:return e+r;default:throw new TypeError(`compile: unknown operator type: ${s} ${L[s]}`)}}var j=Symbol("Domex.ref"),Qe=console.log.bind(console),g=[[t.void,"\u03B5"]],me=({createElement:n,createTextNode:s,_createRawHTMLNode:o})=>function e(r,c={}){let{data:a,key:i,lib:u={},marks:b={},depth:w=0}=c,y=r[0],k=y[0];switch(k){case t.void:return[null,g,g];case t.elem:return[n(y[1]),g,g];case t.text:return[s(y[1]),g,g];case t.unsafeRaw:return[o(a==null?"":String(a)),g,g];case t.key:return[s(i==null?"":String(i)),g,g];case t.value:return[s(a==null?"":String(a)),g,g];case t.deref:{let l=y[1].substr(1),m=typeof a;if(!(l in u))throw new ReferenceError("Unknown reference @"+l);if(a!=null&&m==="object"||m==="function"){b[l]==null&&(b[l]=new WeakMap);let p=b[l].get(a);p==null||p>w?b[l].set(a,w):w>p&&(a=Symbol("Circular"))}c={data:a,key:i,lib:u,marks:b,depth:w+1};let f=u[l],d=a;if("ast"in f){typeof f.prepareData=="function"&&(d=f.prepareData(a,i),c.data=d);let p=e(f.ast,c);if(p[0]){let h={elem:p[0],value:a,data:d,key:i};Object.setPrototypeOf(h,f),p[0][j]=h}return p}else{let p=e(f,c);if(p[0]){let h={value:a,data:d,key:i,expr:f};p[0][j]=h}return p}}case t.withlib:{let l=Object.create(u);return Object.assign(l,y[1]),e(r[1],{data:a,key:i,lib:l,marks:b,depth:w})}case t.context:return e(r[1],y[1]);case t.letin:{let l=Object.create(u);return l[y[1]]=r[1],e(r[2],{data:a,key:i,lib:l,marks:b,depth:w})}case t.bind:case t.bindi:return i=y[1].substr(1),a=a==null?void 0:a[i],e(r[1],{data:a,key:i,lib:u,marks:b,depth:w});case t.ttest:{let l=y[1].substr(2),m=a===null?"null":Array.isArray(a)?"array":typeof a;if(m==="object"&&a.type&&(m=a.type),l!==m)return[null,g,g];let[f,d,p]=e(r[1],c);return f&&f.classList&&f.classList.add(l),[f,d,p]}case t.test:{let l=y[1].substr(1);if(!(a==null?!1:a[l]))return[null,g,g];let[f,d,p]=e(r[1],c);return f&&f.classList&&f.classList.add(l),[f,d,p]}case t.iter:{if(a==null)return[null,g,g];if(typeof a!="object"&&(a=[]),a[ge]==null)return a=y[1].length>1?ye(a[y[1].substr(1)]):ye(a),a[ge]=!0,e(r,{data:a,key:i,lib:u,marks:b,depth:w});{let l=a.next();if(l.done)return[null,g,g];let[m,f]=l.value,[d,p,h]=e(r[1],{data:f,key:m,lib:u,marks:b,depth:w}),v=N(h,[[t.context,c],r]);return[d,p,N(h,v)]}}case t.descend:{let[l,m,f]=e(r[1],c);if(!l)return[null,g,g];let d=[[t.context,{data:a,key:i,lib:u,marks:b,depth:w}],r[2]];return[l,N(m,d),f]}case t.sibling:{let[l,m,f]=e(r[1],c);if(l==null)return e(r[2],c);let d=[[t.context,c],N(f,r[2])];return[l,m,d]}case t.append:{let[l,m,f]=e(r[1],c);if(l==null)return[null,g,g];let d=N(m,[[t.context,c],r[2]]);return[l,d,f]}case t.orelse:{for(let l=1,m=r.length;l<m;l++){let[f,d,p]=e(r[l],c);if(f!=null)return[f,d,p]}return[null,g,g]}case t.class:{let[l,m,f]=e(r[1],c);return l&&l.classList&&l.classList.add(y[1].substr(1)),[l,m,f]}case t.hash:{let[l,m,f]=e(r[1],c);return l&&l.setAttribute&&l.setAttribute("id",y[1].substr(1)),[l,m,f]}case t.attr:{let[l,m,f]=e(r[2],c);return l&&l.setAttribute&&ze(l,r[1],c),[l,m,f]}default:throw new TypeError(`eval: unknown operator type: ${k} ${L[k]}`)}};function N(n,s){return n[0][0]===t.void?s:s[0][0]===t.void?n:[[t.sibling,"+"],n,s]}function ze(n,s,o){if(s[0][0]===t.collate)for(let e=0,r=s.length;e<r;e++)he(n,s[e],o);else he(n,s,o)}function he(n,s,o){s[0][0]===t.unquoted&&n.setAttribute(s[0][1],""),s[0][0]===t.assign&&n.setAttribute(s[1][0][1],Ze(s[2],o))}function Ze([[n,s]],o){let e=o.data;switch(n){case t.keyIn:return o.key;case t.valueIn:return e==null?"":String(s==="%"?e:e[s.substr(1)]);default:return s}}function*xe(){}var Ye=xe.constructor,ge=Symbol("unfold.generator");function*ye(n){if(n!=null)if(Symbol.iterator in n){let s=0;for(let o of n)yield[s++,o]}else yield*Object.entries(n)}var Te=document.createElement.bind(document),je=document.createTextNode.bind(document),Oe=me({createElement:Te,createTextNode:je}),B=(n,s,...o)=>typeof s=="function"&&s.call(n,...o),$e={default:z(te(`
    ( span::number    > %
    | span::bigint    > %
    | span::string    > %
    | span::boolean   > %
    | span::null      > "null"
    | span::function  > "function " + %name
    | span::undefined > "undefined"
    | span::symbol    > %
    | ul::array       > li* > @default
    | dl::object      > di* > dt $ + (dd > @default)
    | dl.unknown      > di* > dt $ + (dd > @default) )`,ne)),"unsafe-raw-html":[[t.unsafeRaw,"@unsafe-raw-html"]]},Z=class{constructor(s){this.ast=z(te(s,ne)),this.exports=this.ast[0][0]===t.withlib?this.ast[0][1]:Object.create(null)}withLib(s){let o={ast:[[t.withlib,s],this.ast],exports:this.exports};return Object.setPrototypeOf(o,Z.prototype)}emitEvent(s,o){let e=this.elem?.parentNode;if(e){let r=new CustomEvent(s,{detail:o,bubbles:!0});return e.dispatchEvent(r)}}render(s,o=null){let e={data:s,key:o,lib:$e},r=document.createDocumentFragment(),{elem:c,deriv:a}=G(this.ast,e),i=c&&c[j];for(;c;)i instanceof Z?(B(i,i.didRender,i.value,i.data),r.append(c),B(i,i.didMount,i.value,i.data)):r.append(c),{elem:c,deriv:a}=G(a,e);return{elem:r.childNodes[0],elems:r}}};function G(n,s){let[o,e,r]=Oe(n,s);if(o&&o instanceof Element&&e){let{elem:c,deriv:a}=G(e,s);for(;c;){let i=c&&c[j];i instanceof Z?(B(i,i.didRender,i.value,i.data),o.append(c),B(i,i.didMount,i.value,i.data)):o.append(c),{elem:c,deriv:a}=G(a,s)}}return{elem:o,deriv:r}}Z.refKey=j;var rt=(...n)=>new Z(String.raw(...n)),ot="0.8.1-dev";export{Z as Domex,rt as domex,ot as version};
