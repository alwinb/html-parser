<link rel="stylesheet" href="style/base.css">
<style>

html {
  font-size:20px;
  font-family:Sans-Serif;
}
body {
  font-size:14px;
  margin:2rem 2em;
}
* {
  box-sizing:border-box;
  line-height:1rem;
}
ul {
  margin:0;
  padding:0 0 0 1.5rem;
}
#input {
  width:calc(100vw - 4em);
  height:10rem;
}
#view1, #view2 {
  width:calc(50vw - 4em);
  float:left;
}
.Console {
  background:#fffd;
  width:100vw;
  height:20vh;
  position:absolute;
  top:0;
  overflow-y:scroll;
}
.DomTree {
  /*font-family:Hack, Monaco, Menlo, Monospace;*/
  /*font-size:12px;*/
  overflow:scroll;
  padding:1rem;
  font-weight:bold;
}
div.children {
  margin-left:.8em;
  padding-left:.5em;
  border-left:1.5px solid black;
  white-space:pre;
}
div.children:after {
  content:'';
  display:block;
  clear:both;
  height:0px;
}
.text {
  font-weight:normal;
  font-style:italic;
  background:#eee;
  min-height:rem;
  display:inline-block;
}

</style>
<body>
<!-- Comment -->
<h1>Dom viewer</h1>

<p>This is a test page for the HTML parser,
On the top, enter sample input. On the left, will be the DOM tree as parsed by the browser, and on the right, will be the tree as parsed by my HTML parser.</p>

Sample
<textarea id=input>
</textarea>

<div id=view1 class=DomTree>
Browser
</div>
<div id=view2 class=DomTree>
Html Parser
</div>

<script src="./scripts/console.js"></script>
<script>
  window.console = new Console ()
  document.body.append (console.elem)
  window.addEventListener ('error', evt => console.errorHandler (evt), true)
</script>
<script src="../dist/html.min.js"></script>
<script>
  "use strict"
  const { html }  = modules
  const el = name => document.createElement (name)
  const log = console.log.bind (console)

  const setProps = (el, props) => {
    for (let k in props) el.setAttribute (k, props[k])
  }

  Object.defineProperty (Object.prototype, Symbol.toStringTag, { get:function () { return this.constructor.name } })

  // OK lets create the tree
  // MDN: In addition, every kind of DOM node is represented by an interface based on Node. These include Attr, CharacterData (which Text, Comment, and CDATASection are all based on), ProcessingInstruction, DocumentType, Notation, Entity, and EntityReference.

  function nativeParse (input) {
    return new DOMParser () .parseFromString (input, 'text/html')
  }

  const objectKey = Symbol ()
  function showTree (domNode) {
    let elem, label, clss

    if (domNode instanceof Text) {
      clss = (/^\s*$/.test (domNode.data)) ? 'space' : 'text'
      elem = el ('span')
      elem.append (domNode.data)
      elem.className = clss
      elem[objectKey] = domNode
      return elem
    }
    if (typeof domNode === 'string') {
      clss = (/^\s*$/.test (domNode)) ? 'space' : 'text'
      elem = el ('span')
      elem.append (domNode)
      elem.className = clss
      elem[objectKey] = domNode
      return elem
    }

    elem = el ('div')
    if (domNode instanceof Document || domNode instanceof html.Document)
      label = '#document'

    else if (domNode instanceof Comment)
      label = '<!-->'

    else if (domNode instanceof Element || domNode instanceof html.Node || domNode instanceof html.Leaf)
      label = (domNode.tagName||domNode.name).toLowerCase ()
    
    // log (domNode.__proto__)
    elem.append (label)
    elem[objectKey] = domNode
    
    if (clss) elem.classList.add(clss)
    let ul; elem.append ((ul = el('div')))
    ul.className = 'children'
    for (let x of domNode.childNodes || domNode.children || []) {
      ul.append (showTree (x))
    }
    return elem
  }

  document.addEventListener ('click', evt => {
    if (objectKey in evt.target)
      log (evt.target[objectKey].info)
  })

  const root = el ('ul')
  var sample = '<select>Foo<option>Bar<optgroup><select>Baz<optgroup>Item<li>item<di>Di'
  var sample = '<option>Item<li>item<di><option><select><option>Item<li>item<di><option><select>'
  var sample = '<option>Item<li>item<di><option>Item2<li>item<di><option><select><option>Item<li>item<di><option><option>Item2<li>item<di>'
  var sample = '<table><td>foo<tr><td>bar<col>'
  document.getElementById ('view1').append (showTree (nativeParse (sample)))
  document.getElementById ('view2').append (showTree (html.parse (sample)))

</script>


